# MySQL 数据库索引

## 一、索引是什么？

索引（index）是帮助数据库高效查找数据的数据结构 。

在较大数据量的表中，为某一字段创建索引 ，要耗费比较长的时间（几十秒）。

在数据库中，查找数据时：

- 没有索引，采用全表扫描的方式查找。
- 有索引， 采用数据结构特有的方式进行查找。

索引形成的数据结构，会以文件的形式，存储在本地。

## 二、索引的优点和缺点

优点：

1. 通过索引列，提高数据查询的效率，降低数据库的 IO 成本。
2. 通过索引列，对数据进行排序，降低数据排序的成本，降低 CPU 消耗。

缺点：

1. 索引会占用存储空间。
2. 索引降低了 INSERT、UPDATE、DELETE 语句（操作）的效率。

索引的缺点，在实际业务开发中，可忽略不计。

## 三、MySQL 索引结构

MySQL 数据库，支持的索引结构有很多；比如：

- Hash 索引；
- B+Tree 索引；
- Full-Text 索引。

MySQL 默认使用 B+Tree 结构的索引。

- 不采用二叉平衡树，或红黑树作为索引的数据结构，原因是：在大数据量下，树的层级太深，检索慢。
- 二叉平衡树、红黑树，它们的特点一个节点，只能有两个子节点。在大数据量下，会造成树的高度太大，检索速度慢。

红黑树数据结构中，1000 万条数据，高度大概是 23 左右：

- 意味着一个用户，一次查询，可能需要 23 次磁盘 IO；
- 那么 100 万用户，高并发访问，效率是极其低下的；

所以，为了减少红黑树的高度，就要增加树的**宽度**。

B+Tree 数据结构，不像红黑树，它每一个节点都能保存多个数据：这样节点的宽度，就会增加，从而降低树的高度。

### 1.B+Tree（多路平衡搜索树）

B+Tree 是一颗“矮胖”的树。

B+Tree 数据结构，如下图所示：

![B+Tree数据结构](NoteAssets/B+Tree数据结构.png)

B+Tree 结构的特点：

- 树的每一个节点，可以存储多个 key；有 n 个key，就有 n 个指针指向子节点；
- 所有的数据，都存储在叶子（最后一层）节点上；
- 非叶子节点，仅用于对数据进行索引，存储的是：key + 指针，使用二分查找进行判断；
- 为了提高范围查询效率，叶子节点之间，又形成了一个双向链表的数据结构，便于数据的排序及区间范围查询。

> B+Tree 数据结构拓展：
>
> 非叶子节点，都是由 key + 指针域组成的：
>
> - 一个 key 占 8 字节，一个指针占 6 字节，一个节点总共容量是 16 KB;
> - 可以计算出一个节点，可以存储的元素个数：16 * 1024 字节 / (8 + 6) = 1170 个元素。
>
> 查看 MySQL 索引节点大小：
>
> ```mysql
> SHOW GLOBAL STATUS LIKE 'innodb_page_size';  -- 节点大小：16384
> ```
>
> 当根节点中，可以存储 1170 个元素，根据每个元素的地址值，又会找到下面的子节点，每个子节点也会存储 1170 个元素。
>
> - 第二层，即第二次 IO 时，能找到的最大数据范围大概是：1170 * 1170 = 135 W。
> - 也就是说 B+Tree 数据结构中，只需要经历两次磁盘 IO，就可以找到 135 W 条数据。
>
> 如果第二层每个元素有指针，那么会找到第三层，第三层也由 key + 数据组成：
>
> - 假设 key + 数据总大小是 1 KB，而每个节点一共能存储 16 KB；
> - 所以第三层一个节点大概可以存储 16 个元素（即 16 条记录）。
> - 结合第二层，最多有 135 W 个元素，每个元素通过指针域，能找到第三层的节点，
> - 第三层总元素大小就是：135 W * 16 = 2000 W+ 个元素。
>
> 结合上述分析 B+Tree 有如下优点：
>
> - 千万条数据，B+Tree 可以控制在小于等于 3 的高度。
> - 所有的数据，都存储在叶子节点上：
>   - 底层已经实现了按照索引进行排序；
>   - 叶子节点是一个双向链表，还支持范围查询，即从小到大或者从大到小查找。

## 四、MySQL 索引操作语法

### 1.MySQL 创建索引

语法如下：

```mysql
CREATE [UNIQUE] INDEX 索引名 ON 表名 (字段名, ...) ;
```

案例：为员工表 emp 的 name 字段，建立一个索引：

```mysql
CREATE INDEX idx_emp_name ON emp (name);
```

- 索引名，一般按照这种格式命名 `idx_表名_字段名`

表中字段，如果有主键约束（PRIMARY），MySQL 会自动为该字段创建**主键索引**，它的性能也是最高的。

表中字段，如果有唯一约束（UNIQUE），MySQL 会自动为该字段创建**唯一索引**。

### 2.MySQL 查看索引

语法如下：

```mysql
SHOW INDEX FROM 表名;
```

案例：查询员工表 emp 的索引信息：

```mysql
SHOW INDEX FROM emp;
```

### 3.MySQL 删除索引

语法如下：

```mysql
DROP INDEX 索引名 ON 表名;
```

案例：删除员工表 emp 中 name 字段的索引

```mysql
DROP INDEX idx_emp_name ON emp;
```
