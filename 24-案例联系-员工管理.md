# 案例联系之员工管理

## 一、员工列表（分页）查询

#### 1.员工列表（分页）查询基本信息

> 请求路径：/emps
>
> 请求方式：GET
>
> 接口描述：该接口用于员工列表数据的条件分页查询

#### 2.员工列表（分页）查询请求参数

参数格式：queryString

参数说明：

| 参数名称 | 是否必须 | 示例       | 备注                                       |
| -------- | -------- | ---------- | ------------------------------------------ |
| name     | 否       | 张         | 姓名                                       |
| gender   | 否       | 1          | 性别 , 1 男 , 2 女                         |
| begin    | 否       | 2010-01-01 | 范围匹配的开始时间(入职日期)               |
| end      | 否       | 2020-01-01 | 范围匹配的结束时间(入职日期)               |
| page     | 是       | 1          | 分页查询的页码，如果未指定，默认为1        |
| pageSize | 是       | 10         | 分页查询的每页记录数，如果未指定，默认为10 |

请求数据样例：

```url
/emps?name=张&gender=1&begin=2007-09-01&end=2022-09-01&page=1&pageSize=10
```

#### 3.员工列表（分页）查询响应数据

参数格式：application/json

参数说明：

| 名称           | 类型      | 是否必须 | 默认值 | 备注                                                         | 其他信息          |
| -------------- | --------- | -------- | ------ | ------------------------------------------------------------ | ----------------- |
| code           | number    | 必须     |        | 响应码, 1 成功 , 0 失败                                      |                   |
| msg            | string    | 非必须   |        | 提示信息                                                     |                   |
| data           | object    | 必须     |        | 返回的数据                                                   |                   |
| \|- total      | number    | 必须     |        | 总记录数                                                     |                   |
| \|- rows       | object [] | 必须     |        | 数据列表                                                     | item 类型: object |
| \|- id         | number    | 非必须   |        | id                                                           |                   |
| \|- username   | string    | 非必须   |        | 用户名                                                       |                   |
| \|- name       | string    | 非必须   |        | 姓名                                                         |                   |
| \|- password   | string    | 非必须   |        | 密码                                                         |                   |
| \|- entrydate  | string    | 非必须   |        | 入职日期                                                     |                   |
| \|- gender     | number    | 非必须   |        | 性别 , 1 男 ; 2 女                                           |                   |
| \|- image      | string    | 非必须   |        | 图像                                                         |                   |
| \|- job        | number    | 非必须   |        | 职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师 |                   |
| \|- deptId     | number    | 非必须   |        | 部门id                                                       |                   |
| \|- createTime | string    | 非必须   |        | 创建时间                                                     |                   |
| \|- updateTime | string    | 非必须   |        | 更新时间                                                     |                   |

响应数据样例：

```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "total": 2,
    "rows": [
       {
        "id": 1,
        "username": "jinyong",
        "password": "123456",
        "name": "金庸",
        "gender": 1,
        "image": "https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-02-00-27-53B.jpg",
        "job": 2,
        "entrydate": "2015-01-01",
        "deptId": 2,
        "createTime": "2022-09-01T23:06:30",
        "updateTime": "2022-09-02T00:29:04"
      },
      {
        "id": 2,
        "username": "zhangwuji",
        "password": "123456",
        "name": "张无忌",
        "gender": 1,
        "image": "https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-02-00-27-53B.jpg",
        "job": 2,
        "entrydate": "2015-01-01",
        "deptId": 2,
        "createTime": "2022-09-01T23:06:30",
        "updateTime": "2022-09-02T00:29:04"
      }
    ]
  }
}
```

#### 4.员工列表（分页）查询接口开发

创建员工实体类 Emp

demo-project/javaweb-practise/src/main/java/com/kkcf/pojo/Emp.java

```java
package com.kkcf.pojo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalDateTime;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class Emp {
    private Integer id;
    private String username;
    private String password;
    private String name;
    private Short gender;
    private String image;
    private Short job;
    private LocalDate entrydate;
    private Integer deptId;
    private LocalDateTime createTime;
    private LocalDateTime updateTime;
}
```

返回的信息有两部分，员工记录总数，员工分页列表详情。

- 可以考虑用 Map 集合，或者实体（pojo）类来进行封装。
- 这里使用实体（pojo）类进行封装。

创建员工分页查询实体类 EmpPageBean

```java
package com.kkcf.pojo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class EmpPageBean {
    private Long total;
    private List<Emp> rows;
}
```

在 Dao 层的 EmpMapper 接口中：

- 定义 listWithPagination 方法，用于分页查询员工信息。
- 定义 listCount 方法，用于查询员工总数

demo-project/javaweb-practise/src/main/java/com/kkcf/mapper/EmpMapper.java

```java
package com.kkcf.mapper;

import com.kkcf.pojo.Emp;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Select;

import java.util.List;

@Mapper
public interface EmpMapper {
    @Select("SELECT id, username, password, name, gender, image, job, entrydate, dept_id, create_time, update_time FROM emp LIMIT #{offset}, #{limit}")
    List<Emp> listWithPagination(int offset, int limit);

    @Select("SELECT COUNT(*) FROM emp;")
    Long listCount();
}
```

在 Service 层的 EmpService 接口中，定义 listWithPageAndCount 方法，

demo-project/javaweb-practise/src/main/java/com/kkcf/service/EmpService.java

```java
package com.kkcf.service;

import com.kkcf.pojo.EmpPageBean;

public interface EmpService {
    EmpPageBean listWithPageAndCount(Integer page, Integer pageSize);
}
```

在 Service 层的 EmpServiceImpl 实现类中，实现 listWithPageAndCount  方法：

```java
package com.kkcf.service.impl;

import com.kkcf.mapper.EmpMapper;
import com.kkcf.pojo.Emp;
import com.kkcf.pojo.EmpPageBean;
import com.kkcf.service.EmpService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class EmpServiceImpl implements EmpService {
    @Autowired
    private EmpMapper empMapper;

    @Override
    public EmpPageBean listWithPageAndCount(Integer page, Integer pageSize) {
        int offset = (page - 1) * pageSize;
        List<Emp> rows = empMapper.listWithPagination(offset, pageSize);

        Long total = empMapper.listCount();

        return new EmpPageBean(total, rows);
    }
}
```

在 Controller 层的控制器类 EmpController 中，定义请求处理方法 listWithPageAndCount

```java
package com.kkcf.controller;

import com.kkcf.pojo.EmpPageBean;
import com.kkcf.pojo.Result;
import com.kkcf.service.EmpService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@Slf4j
@RestController
@RequestMapping("/emps")
public class EmpController {
    @Autowired
    private EmpService empService;

    @GetMapping
    public Result<EmpPageBean> listWithPageAndCount(@RequestParam(defaultValue = "1") Integer page, @RequestParam(defaultValue = "10") Integer pageSize) {
        log.info("查询员工信息，分页：{},{}", page, pageSize);

        EmpPageBean empPageBean = empService.listWithPageAndCount(page, pageSize);
        return Result.success(empPageBean);
    }
}
```

## 二、@RequestParam 注解指定默认值

上方代码中，使用 @RequestParam 注解的 `defaultValue` 属性，指定了请求参数的默认值

```java
public Result<EmpPageBean> listWithPageAndCount(@RequestParam(defaultValue = "1") Integer page, @RequestParam(defaultValue = "10") Integer pageSize) {
    // ……
}
```

## 三、MyBatis 分页查询插件 PageHelper

引入 PageHelper 与 Spring Boot 整合的依赖。